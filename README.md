# 🎁 Arduino 自動扭蛋機（Capsule Gacha Machine）

一台使用 Arduino 製作的扭蛋機，具有投幣感應、按鈕觸發、可變機率獎勵判斷、LED 轉盤與伺服馬達控制扭蛋功能！

## 📦 功能特色

- 🎛️ 可變電阻調整大獎（2 顆扭蛋）出現機率
- 🎲 轉盤式 LED 特效決定抽獎結果
- 🧠 使用 AceRoutine 管理狀態流程（Coroutine）

## 🔧 硬體需求

| 元件 | 說明 |
|------|------|
| Arduino Uno / Nano | 控制核心 |
| 光敏電阻（LDR） | 投幣感應 |
| 可變電阻（VR） | 控制中獎機率 |
| 按鈕（x2） | 抽獎按鈕 / 強制發放按鈕 |
| 伺服馬達（SG90） | 推出扭蛋 |
| 74HC595 IC | 控制 8 顆 LED |
| 四個顏色的LED x8 | 顯示抽獎轉盤與結果 |
| 電阻、單芯線、洞洞板 | 基礎連接材料 |

## ⚙️ 腳位配置

| 腳位 | 功能 |
|------|------|
| A0 | 隨機種子（未接模擬浮動） |
| A1 | 可變電阻輸入 |
| A3 | 光敏電阻輸入 |
| 2  | 74HC595 資料腳（Data） |
| 3  | 74HC595 鎖存腳（Latch） |
| 4  | 74HC595 時脈腳（Clock） |
| 8  | 強制轉出扭蛋按鈕 |
| 9  | 投幣後抽獎按鈕 |
| 10 | 光敏電阻 VCC 控制腳 |
| 11 | 可變電阻 VCC 控制腳 |
| 12 | 伺服馬達控制腳 |

## 🧠 抽獎邏輯

1. 感應到投幣（LDR亮度變化） → 進入待抽獎狀態  
2. 按下抽獎按鈕 → 啟動 LED 轉盤  
3. 可按下按鈕提早停下轉盤（進階技巧）  
4. 根據轉盤停留結果及可變電阻決定獎項：
    - 0 顆（黃色）：老師上課沒有獎
    - 1 顆（綠色）：普通獎
    - 2 顆（紅色）：大獎！
    - 再來一次（白色）：重抽一次  
5. 根據中獎數量，控制馬達推出扭蛋

## 📂 程式架構重點

- 使用 [AceRoutine](https://github.com/bxparks/AceRoutine) 處理非阻塞式多階段流程
- 多個 `COROUTINE()` 協程對應：
  - `step0`：待機動畫
  - `step1`：投幣與按鈕觸發
  - `step2`：轉盤動畫與結果判定
  - `step4`：依結果更新狀態
  - `step5`：控制伺服馬達發送扭蛋
  - `reward_led_blink`：閃爍中獎 LED
  - `flash_all_led`：顯示投幣完成效果
  - `force_btn`：緊急模式可一次發送6顆扭蛋

---

## 📸 實機照片 / Demo
