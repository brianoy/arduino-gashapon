# 🎁 Arduino 自動扭蛋機（Capsule Gacha Machine）

一台使用 Arduino 製作的扭蛋機，具有投幣感應、按鈕觸發、可變機率獎勵判斷、LED 轉盤與伺服馬達控制轉蛋功能

## 📦 功能特色

- 🎛️ 可變電阻調整大獎（2 顆扭蛋）出現機率
- 🎲 轉盤式 LED 特效決定抽獎結果
    - 0 顆（黃色）：老師上課沒有獎
    - 1 顆（綠色）：普通獎
    - 2 顆（紅色）：大獎！
    - 再來一次（白色）：重抽一次
- 🧠 使用 AceRoutine 管理狀態流程（Coroutine）
  
## 📸 實機照片
| 外觀 | 內部結構 |
|:------------:|:-------------:|
| <img src="https://github.com/user-attachments/assets/295674b7-0fbd-48e6-93c8-15ffeb335b99" width = "100%">|<img src="https://github.com/user-attachments/assets/f4ef3f5f-1e1c-4b00-aecd-8b1a2a761d9b" width = "60%">|

---

## 韌體
1. 進入arduino ide->上方`工具`->`管理程式庫`->`開發板管理員`->搜尋`aceroutine`->`安裝`
2. 打開下載的程式，寫入
   
### 程式架構重點

- 使用 [AceRoutine](https://github.com/bxparks/AceRoutine) 處理非阻塞式多階段流程
- 多個 `COROUTINE()` 協程對應：
  - `step0`：未投幣的待機動畫
  - `step1`：投幣後與第一次按鈕觸發
  - `step2`：第二次按鈕觸發、轉盤動畫與結果判定
  - `step4`：依結果更新狀態
  - `step5`：控制伺服馬達發送扭蛋
  - `reward_led_blink`：閃爍中獎 LED
  - `flash_all_led`：顯示投幣完成效果
  - `force_btn`：背後按鈕可一次出6顆扭蛋

## 硬體

### 電子元件

| 元件 | 說明 |
|------|------|
| holtek-BM53A367A | 控制核心 |
| 光敏電阻（LDR） | 投幣感應 |
| 可變電阻（VR） | 控制中獎機率 |
| 按鈕（x2） | 抽獎按鈕 / 強制發放按鈕 |
| 伺服馬達（SG90） | 推出扭蛋 |
| 74HC595 IC | 控制 8 顆 LED |
| 四個顏色的LED各2 | 顯示抽獎轉盤與結果 |
| 電阻、漆包線、洞洞板 | 基礎連接材料 |

### 腳位配置

| 腳位 | 功能 |
|------|------|
| A0 | 隨機種子（未接、模擬浮動） |
| A1 | 可變電阻輸入 |
| A3 | 光敏電阻輸入 |
| 2  | 74HC595 資料腳（Data） |
| 3  | 74HC595 鎖存腳（Latch） |
| 4  | 74HC595 時脈腳（Clock） |
| 8  | 強制轉出扭蛋按鈕 |
| 9  | 投幣後抽獎按鈕 |
| 10 | 光敏電阻 VCC 控制腳 |
| 11 | 可變電阻 VCC 控制腳 |
| 12 | 伺服馬達控制腳 |


